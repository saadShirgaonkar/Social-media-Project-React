{"ast":null,"code":"/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport _asyncToGenerator from '@babel/runtime/helpers/asyncToGenerator';\nimport _slicedToArray from '@babel/runtime/helpers/slicedToArray';\nimport _regeneratorRuntime from '@babel/runtime/regenerator';\nimport * as React from 'react';\nimport { AuthSdkError, toRelativeUrl } from '@okta/okta-auth-js';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport _objectWithoutProperties from '@babel/runtime/helpers/objectWithoutProperties';\nimport { useRouteMatch, Route } from 'react-router-dom';\nvar OktaContext = /*#__PURE__*/React.createContext(null);\n\nvar useOktaAuth = function useOktaAuth() {\n  return React.useContext(OktaContext);\n};\n\nvar OktaError = function OktaError(_ref) {\n  var error = _ref.error;\n\n  if (error.name && error.message) {\n    return /*#__PURE__*/React.createElement(\"p\", null, error.name, \": \", error.message);\n  }\n\n  return /*#__PURE__*/React.createElement(\"p\", null, \"Error: \", error.toString());\n};\n\nvar Security = function Security(_ref) {\n  var oktaAuth = _ref.oktaAuth,\n      restoreOriginalUri = _ref.restoreOriginalUri,\n      onAuthRequired = _ref.onAuthRequired,\n      children = _ref.children;\n\n  var _React$useState = React.useState(function () {\n    if (!oktaAuth) {\n      return null;\n    }\n\n    return oktaAuth.authStateManager.getAuthState();\n  }),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      authState = _React$useState2[0],\n      setAuthState = _React$useState2[1];\n\n  var _React$useState3 = React.useState(function () {\n    if (!oktaAuth || !oktaAuth._oktaUserAgent) {\n      return null;\n    }\n\n    var oktaAuthVersion = oktaAuth._oktaUserAgent.getVersion();\n\n    var majorVersion = oktaAuthVersion === null || oktaAuthVersion === void 0 ? void 0 : oktaAuthVersion.split('.')[0];\n    return majorVersion;\n  }),\n      _React$useState4 = _slicedToArray(_React$useState3, 1),\n      oktaAuthMajorVersion = _React$useState4[0];\n\n  React.useEffect(function () {\n    if (!oktaAuth || !restoreOriginalUri) {\n      return;\n    }\n\n    if (oktaAuth.options.restoreOriginalUri && restoreOriginalUri) {\n      console.warn('Two custom restoreOriginalUri callbacks are detected. The one from the OktaAuth configuration will be overridden by the provided restoreOriginalUri prop from the Security component.');\n    }\n\n    oktaAuth.options.restoreOriginalUri = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(oktaAuth, originalUri) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                restoreOriginalUri(oktaAuth, originalUri);\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function (_x, _x2) {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    if (oktaAuth._oktaUserAgent) {\n      oktaAuth._oktaUserAgent.addEnvironment(\"@okta/okta-react\".concat(\"/\", \"6.2.0\"));\n    } else {\n      console.warn('_oktaUserAgent is not available on auth SDK instance. Please use okta-auth-js@^5.3.1 .');\n    }\n\n    var handler = function handler(authState) {\n      setAuthState(authState);\n    };\n\n    oktaAuth.authStateManager.subscribe(handler);\n\n    if (!oktaAuth.isLoginRedirect()) {\n      oktaAuth.start();\n    }\n\n    return function () {\n      oktaAuth.authStateManager.unsubscribe(handler);\n      oktaAuth.stop();\n    };\n  }, [oktaAuth, restoreOriginalUri]);\n\n  if (!oktaAuth) {\n    var err = new AuthSdkError('No oktaAuth instance passed to Security Component.');\n    return /*#__PURE__*/React.createElement(OktaError, {\n      error: err\n    });\n  }\n\n  if (!restoreOriginalUri) {\n    var _err = new AuthSdkError('No restoreOriginalUri callback passed to Security Component.');\n\n    return /*#__PURE__*/React.createElement(OktaError, {\n      error: _err\n    });\n  }\n\n  if (oktaAuthMajorVersion !== \"5\" && process.env.SKIP_VERSION_CHECK !== '1') {\n    var _err2 = new AuthSdkError(\"Passed in oktaAuth is not compatible with the SDK, okta-auth-js version \".concat(\"5\", \".x is the current supported version.\"));\n\n    return /*#__PURE__*/React.createElement(OktaError, {\n      error: _err2\n    });\n  }\n\n  return /*#__PURE__*/React.createElement(OktaContext.Provider, {\n    value: {\n      oktaAuth: oktaAuth,\n      authState: authState,\n      _onAuthRequired: onAuthRequired\n    }\n  }, children);\n};\n\nfunction ownKeys$1(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread$1(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys$1(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys$1(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar withOktaAuth = function withOktaAuth(ComponentToWrap) {\n  var WrappedComponent = function WrappedComponent(props) {\n    var oktaAuthProps = useOktaAuth();\n    return /*#__PURE__*/React.createElement(ComponentToWrap, _objectSpread$1(_objectSpread$1({}, oktaAuthProps), props));\n  };\n\n  WrappedComponent.displayName = 'withOktaAuth_' + (ComponentToWrap.displayName || ComponentToWrap.name);\n  return WrappedComponent;\n};\n\nvar LoginCallback = function LoginCallback(_ref) {\n  var errorComponent = _ref.errorComponent,\n      _ref$loadingElement = _ref.loadingElement,\n      loadingElement = _ref$loadingElement === void 0 ? null : _ref$loadingElement,\n      onAuthResume = _ref.onAuthResume;\n\n  var _useOktaAuth = useOktaAuth(),\n      oktaAuth = _useOktaAuth.oktaAuth,\n      authState = _useOktaAuth.authState;\n\n  var _React$useState = React.useState(null),\n      _React$useState2 = _slicedToArray(_React$useState, 2),\n      callbackError = _React$useState2[0],\n      setCallbackError = _React$useState2[1];\n\n  var ErrorReporter = errorComponent || OktaError;\n  React.useEffect(function () {\n    var _a;\n\n    if (onAuthResume && ((_a = oktaAuth.isInteractionRequired) === null || _a === void 0 ? void 0 : _a.call(oktaAuth))) {\n      onAuthResume();\n      return;\n    }\n\n    oktaAuth.handleLoginRedirect().then(function () {\n      oktaAuth.start();\n    })[\"catch\"](function (e) {\n      setCallbackError(e);\n    });\n  }, [oktaAuth]);\n  var authError = authState === null || authState === void 0 ? void 0 : authState.error;\n  var displayError = callbackError || authError;\n\n  if (displayError) {\n    return /*#__PURE__*/React.createElement(ErrorReporter, {\n      error: displayError\n    });\n  }\n\n  return loadingElement;\n};\n\nvar _excluded = [\"onAuthRequired\"];\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nvar SecureRoute = function SecureRoute(_ref) {\n  var onAuthRequired = _ref.onAuthRequired,\n      routeProps = _objectWithoutProperties(_ref, _excluded);\n\n  var _useOktaAuth = useOktaAuth(),\n      oktaAuth = _useOktaAuth.oktaAuth,\n      authState = _useOktaAuth.authState,\n      _onAuthRequired = _useOktaAuth._onAuthRequired;\n\n  var match = useRouteMatch(routeProps);\n  var pendingLogin = React.useRef(false);\n  React.useEffect(function () {\n    var handleLogin = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var originalUri, onAuthRequiredFn;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                if (!pendingLogin.current) {\n                  _context.next = 2;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 2:\n                pendingLogin.current = true;\n                originalUri = toRelativeUrl(window.location.href, window.location.origin);\n                oktaAuth.setOriginalUri(originalUri);\n                onAuthRequiredFn = onAuthRequired || _onAuthRequired;\n\n                if (!onAuthRequiredFn) {\n                  _context.next = 11;\n                  break;\n                }\n\n                _context.next = 9;\n                return onAuthRequiredFn(oktaAuth);\n\n              case 9:\n                _context.next = 13;\n                break;\n\n              case 11:\n                _context.next = 13;\n                return oktaAuth.signInWithRedirect();\n\n              case 13:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function handleLogin() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    if (!match) {\n      return;\n    }\n\n    if (!authState) {\n      return;\n    }\n\n    if (authState.isAuthenticated) {\n      pendingLogin.current = false;\n      return;\n    }\n\n    if (!authState.isAuthenticated) {\n      handleLogin();\n    }\n  }, [!!authState, authState ? authState.isAuthenticated : null, oktaAuth, match, onAuthRequired, _onAuthRequired]);\n\n  if (!authState || !authState.isAuthenticated) {\n    return null;\n  }\n\n  return /*#__PURE__*/React.createElement(Route, _objectSpread({}, routeProps));\n};\n\nexport { LoginCallback, OktaContext, SecureRoute, Security, useOktaAuth, withOktaAuth };","map":{"version":3,"sources":["../../src/OktaContext.ts","../../src/OktaError.tsx","../../src/Security.tsx","../../src/withOktaAuth.tsx","../../src/LoginCallback.tsx","../../src/SecureRoute.tsx"],"names":["OktaContext","useOktaAuth","OktaError","error","React","Security","restoreOriginalUri","onAuthRequired","oktaAuth","useEffect","console","_oktaUserAgent","addEnvironment","setAuthState","authState","stop","err","oktaAuthMajorVersion","_onAuthRequired","withOktaAuth","WrappedComponent","oktaAuthProps","LoginCallback","loadingElement","onAuthResume","setCallbackError","ErrorReporter","errorComponent","handleLoginRedirect","then","displayError","callbackError","authError","pendingLogin","useRef","handleLogin","current","originalUri","setOriginalUri","onAuthRequiredFn","isAuthenticated"],"mappings":"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","sourcesContent":["/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport * as React from 'react';\nimport { AuthState, OktaAuth } from '@okta/okta-auth-js';\n\nexport type OnAuthRequiredFunction = (oktaAuth: OktaAuth) => Promise<void> | void;\nexport type OnAuthResumeFunction = () => void;\n\nexport type RestoreOriginalUriFunction = (oktaAuth: OktaAuth, originalUri: string) => Promise<void> | void;\n\nexport interface IOktaContext {\n    oktaAuth: OktaAuth;\n    authState: AuthState | null;\n    _onAuthRequired?: OnAuthRequiredFunction;\n}\n\nconst OktaContext = React.createContext<IOktaContext | null>(null);\n\nexport const useOktaAuth = (): IOktaContext => React.useContext(OktaContext) as IOktaContext;\n\nexport default OktaContext;\n","/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\n\nconst OktaError: React.FC<{ error: Error }> = ({ error }) => { \n  if(error.name && error.message) { \n    return <p>{error.name}: {error.message}</p>;\n  }\n  return <p>Error: {error.toString()}</p>;\n};\n\nexport default OktaError;\n","/*!\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { AuthSdkError, AuthState, OktaAuth } from '@okta/okta-auth-js';\nimport OktaContext, { OnAuthRequiredFunction, RestoreOriginalUriFunction } from './OktaContext';\nimport OktaError from './OktaError';\n\nconst Security: React.FC<{\n  oktaAuth: OktaAuth,\n  restoreOriginalUri: RestoreOriginalUriFunction, \n  onAuthRequired?: OnAuthRequiredFunction,\n  children?: React.ReactNode\n} & React.HTMLAttributes<HTMLDivElement>> = ({ \n  oktaAuth,\n  restoreOriginalUri, \n  onAuthRequired, \n  children\n}) => { \n  const [authState, setAuthState] = React.useState(() => {\n    if (!oktaAuth) {\n      return null;\n    }\n    return oktaAuth.authStateManager.getAuthState();\n  });\n  const [oktaAuthMajorVersion] = React.useState(() => {\n    if (!oktaAuth || !oktaAuth._oktaUserAgent) {\n      return null;\n    }\n\n    const oktaAuthVersion = oktaAuth._oktaUserAgent.getVersion();\n    const majorVersion = oktaAuthVersion?.split('.')[0];\n    return majorVersion;\n  });\n\n  React.useEffect(() => {\n    if (!oktaAuth || !restoreOriginalUri) {\n      return;\n    }\n\n    // Add default restoreOriginalUri callback\n    if (oktaAuth.options.restoreOriginalUri && restoreOriginalUri) {\n      console.warn('Two custom restoreOriginalUri callbacks are detected. The one from the OktaAuth configuration will be overridden by the provided restoreOriginalUri prop from the Security component.');\n    }\n    oktaAuth.options.restoreOriginalUri = async (oktaAuth: unknown, originalUri: string) => {\n      restoreOriginalUri(oktaAuth as OktaAuth, originalUri);\n    };\n\n    // Add okta-react userAgent\n    if (oktaAuth._oktaUserAgent) {\n      oktaAuth._oktaUserAgent.addEnvironment(`${process.env.PACKAGE_NAME}/${process.env.PACKAGE_VERSION}`);\n    } else {\n      console.warn('_oktaUserAgent is not available on auth SDK instance. Please use okta-auth-js@^5.3.1 .');\n    }\n\n    // Update Security provider with latest authState\n    const handler = (authState: AuthState) => {\n      setAuthState(authState);\n    };\n    oktaAuth.authStateManager.subscribe(handler);\n\n    // Trigger an initial change event to make sure authState is latest\n    if (!oktaAuth.isLoginRedirect()) {\n      // Calculates initial auth state and fires change event for listeners\n      // Also starts the token auto-renew service\n      oktaAuth.start();\n    }\n\n    return () => {\n      oktaAuth.authStateManager.unsubscribe(handler);\n      oktaAuth.stop();\n    };\n  }, [oktaAuth, restoreOriginalUri]);\n\n  if (!oktaAuth) {\n    const err = new AuthSdkError('No oktaAuth instance passed to Security Component.');\n    return <OktaError error={err} />;\n  }\n\n  if (!restoreOriginalUri) {\n    const err = new AuthSdkError('No restoreOriginalUri callback passed to Security Component.');\n    return <OktaError error={err} />;\n  }\n\n  if (oktaAuthMajorVersion !== process.env.AUTH_JS_MAJOR_VERSION \n      // use SKIP_VERSION_CHECK flag to control version check in tests\n      && process.env.SKIP_VERSION_CHECK !== '1') {\n    const err = new AuthSdkError(`Passed in oktaAuth is not compatible with the SDK, okta-auth-js version ${process.env.AUTH_JS_MAJOR_VERSION}.x is the current supported version.`);\n    return <OktaError error={err} />;\n  }\n\n  return (\n    <OktaContext.Provider value={{ \n      oktaAuth, \n      authState, \n      _onAuthRequired: onAuthRequired\n    }}>\n      {children}\n    </OktaContext.Provider>\n  );\n};\n\nexport default Security;\n","/*\n * Copyright (c) 2020-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, IOktaContext } from './OktaContext';\n\nconst withOktaAuth = <P extends IOktaContext>(\n  ComponentToWrap: React.ComponentType<P>\n): React.FC<Omit<P, keyof IOktaContext>> => { \n  const WrappedComponent = (props: Omit<P, keyof IOktaContext>) => { \n    const oktaAuthProps = useOktaAuth();\n    return <ComponentToWrap {...oktaAuthProps as IOktaContext } {...props as P} />;\n  };\n  WrappedComponent.displayName = 'withOktaAuth_' + (ComponentToWrap.displayName || ComponentToWrap.name);\n  return WrappedComponent;\n};\n\nexport default withOktaAuth;\n","/*\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, OnAuthResumeFunction } from './OktaContext';\nimport OktaError from './OktaError';\n\ninterface LoginCallbackProps {\n  errorComponent?: React.ComponentType<{ error: Error }>;\n  onAuthResume?: OnAuthResumeFunction;\n  loadingElement?: React.ReactElement;\n}\n\nconst LoginCallback: React.FC<LoginCallbackProps> = ({ errorComponent, loadingElement = null, onAuthResume }) => { \n  const { oktaAuth, authState } = useOktaAuth();\n  const [callbackError, setCallbackError] = React.useState(null);\n\n  const ErrorReporter = errorComponent || OktaError;\n  React.useEffect(() => {\n    if (onAuthResume && oktaAuth.isInteractionRequired?.() ) {\n      onAuthResume();\n      return;\n    }\n    oktaAuth.handleLoginRedirect().then(() => {\n      // In `<Security>` component service was not started in case of login redirect.\n      // Start it now after `restoreOriginalUri` has been called and route changed.\n      oktaAuth.start();\n    }).catch(e => {\n      setCallbackError(e);\n    });\n  }, [oktaAuth]);\n\n  const authError = authState?.error;\n  const displayError = callbackError || authError;\n  if (displayError) { \n    return <ErrorReporter error={displayError}/>;\n  }\n\n  return loadingElement;\n};\n\nexport default LoginCallback;\n","/*\n * Copyright (c) 2017-Present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n */\n\nimport * as React from 'react';\nimport { useOktaAuth, OnAuthRequiredFunction } from './OktaContext';\nimport { Route, useRouteMatch, RouteProps } from 'react-router-dom';\nimport { toRelativeUrl } from '@okta/okta-auth-js';\n\nconst SecureRoute: React.FC<{\n  onAuthRequired?: OnAuthRequiredFunction;\n} & RouteProps & React.HTMLAttributes<HTMLDivElement>> = ({ \n  onAuthRequired, \n  ...routeProps \n}) => { \n  const { oktaAuth, authState, _onAuthRequired } = useOktaAuth();\n  const match = useRouteMatch(routeProps);\n  const pendingLogin = React.useRef(false);\n\n  React.useEffect(() => {\n    const handleLogin = async () => {\n      if (pendingLogin.current) {\n        return;\n      }\n\n      pendingLogin.current = true;\n\n      const originalUri = toRelativeUrl(window.location.href, window.location.origin);\n      oktaAuth.setOriginalUri(originalUri);\n      const onAuthRequiredFn = onAuthRequired || _onAuthRequired;\n      if (onAuthRequiredFn) {\n        await onAuthRequiredFn(oktaAuth);\n      } else {\n        await oktaAuth.signInWithRedirect();\n      }\n    };\n\n    // Only process logic if the route matches\n    if (!match) {\n      return;\n    }\n\n    if (!authState) {\n      return;\n    }\n\n    if (authState.isAuthenticated) {\n      pendingLogin.current = false;\n      return;\n    }\n\n    // Start login if app has decided it is not logged in and there is no pending signin\n    if(!authState.isAuthenticated) { \n      handleLogin();\n    }  \n\n  }, [\n    !!authState,\n    authState ? authState.isAuthenticated : null, \n    oktaAuth, \n    match, \n    onAuthRequired, \n    _onAuthRequired\n  ]);\n\n  if (!authState || !authState.isAuthenticated) {\n    return null;\n  }\n\n  return (\n    <Route\n      { ...routeProps }\n    />\n  );\n};\n\nexport default SecureRoute;\n"]},"metadata":{},"sourceType":"module"}